<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson Portal</title>
    <style>
        /* Import fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            /* Brand colors */
            --primary-color: #ed1c24;
            --primary-light: rgba(237, 28, 36, 0.1);
            
            /* Light theme */
            --light-background: #fafafa;
            --light-surface: #f5f5f5;
            --light-card: #ffffff;
            --light-text-primary: #333333;
            --light-text-secondary: #666666;
            --light-border: #e0e0e0;
            --light-shadow: rgba(0, 0, 0, 0.08);
            
            /* Dark theme */
            --dark-background: #1a1a1a;
            --dark-surface: #2a2a2a;
            --dark-card: #2f2f2f;
            --dark-text-primary: #f0f0f0;
            --dark-text-secondary: #b0b0b0;
            --dark-border: #404040;
            --dark-shadow: rgba(0, 0, 0, 0.3);
        }

        /* Default to light theme */
        body {
            --background: var(--light-background);
            --surface: var(--light-surface);
            --card: var(--light-card);
            --text-primary: var(--light-text-primary);
            --text-secondary: var(--light-text-secondary);
            --border: var(--light-border);
            --shadow: var(--light-shadow);
        }

        /* Dark theme */
        body.dark-theme {
            --background: var(--dark-background);
            --surface: var(--dark-surface);
            --card: var(--dark-card);
            --text-primary: var(--dark-text-primary);
            --text-secondary: var(--dark-text-secondary);
            --border: var(--dark-border);
            --shadow: var(--dark-shadow);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 0;
            border-bottom: 1px solid var(--primary-color);
            margin-bottom: 32px;
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .theme-toggle {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            border-color: var(--primary-color);
        }

        .theme-icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Search Section */
        .search-section {
            background: var(--card);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 32px;
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .search-bar {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            margin-bottom: 20px;
            transition: border-color 0.2s ease;
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .search-bar::placeholder {
            color: var(--text-secondary);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .filter-select {
            padding: 10px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Active filters */
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }

        .filter-tag {
            background-color: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }

        .filter-tag .remove {
            cursor: pointer;
            font-size: 14px;
            opacity: 0.8;
        }

        .filter-tag .remove:hover {
            opacity: 1;
        }

        /* Results */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary-color);
        }

        .results-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Lesson Cards */
        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 48px;
        }

        .lesson-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px var(--shadow);
            text-decoration: none;
            color: inherit;
        }

        .lesson-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow);
            text-decoration: none;
            color: inherit;
        }

        .lesson-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .lesson-description {
            color: var(--text-secondary);
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.5;
        }

        .lesson-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 16px;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .meta-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .meta-value {
            color: var(--text-primary);
        }

        .lesson-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            background: var(--surface);
            color: var(--text-secondary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid var(--border);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 32px 0;
            color: var(--text-secondary);
            border-top: 1px solid var(--primary-color);
            margin-top: 48px;
            font-size: 14px;
        }

        /* Links */
        a {
            color: var(--primary-color);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Hidden class for filtering */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .filters {
                grid-template-columns: 1fr;
            }
            
            .lessons-grid {
                grid-template-columns: 1fr;
            }
            
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Lesson Portal</h1>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
                <svg class="theme-icon" id="themeIcon" viewBox="0 0 24 24">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <span id="themeText">Dark Mode</span>
            </button>
        </div>

        <div class="search-section">
            <input 
                type="text" 
                class="search-bar" 
                placeholder="Search lessons..."
                id="searchInput"
            >
            
            <div class="filters">
                <div class="filter-group">
                    <label for="skillLevel">Programming Skill Level</label>
                    <select class="filter-select" id="skillLevel">
                        <option value="">All Levels</option>
                        <option value="None">None</option>
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Advanced">Advanced</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="primaryCourse">Primary Course</label>
                    <select class="filter-select" id="primaryCourse">
                        <option value="">All Courses</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="format">Format</label>
                    <select class="filter-select" id="format">
                        <option value="">All Formats</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="instructor">Instructor</label>
                    <select class="filter-select" id="instructor">
                        <option value="">All Instructors</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
            </div>

            <div class="filter-tags" id="activeFilters">
                <!-- Active filter tags appear here -->
            </div>
        </div>

        <div class="results-header">
            <h2>Available Lessons</h2>
            <div class="results-count" id="resultsCount">Loading lessons...</div>
        </div>

        <div class="lessons-grid" id="lessonsGrid">
            <!-- Lesson cards will be populated dynamically -->
        </div>

        <footer class="footer">
            <p>Lesson Portal - Updated automatically via GitHub Actions</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
    <script>
        let allLessons = [];
        let fuse = null;

        // Theme management
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            body.classList.toggle('dark-theme');
            
            if (body.classList.contains('dark-theme')) {
                // Sun icon for light mode toggle
                themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
                themeText.textContent = 'Light Mode';
                localStorage.setItem('theme', 'dark');
            } else {
                // Moon icon for dark mode toggle
                themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
                themeText.textContent = 'Dark Mode';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeIcon').innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
                document.getElementById('themeText').textContent = 'Light Mode';
            }
        }

        // Load lessons data
        async function loadLessons() {
            try {
                const response = await fetch('lessons.json');
                allLessons = await response.json();
                
                // Initialize search
                fuse = new Fuse(allLessons, {
                    keys: ['title', 'description', 'tags', 'instructor', 'primary_course'],
                    threshold: 0.3
                });
                
                // Populate filter options
                populateFilterOptions();
                
                // Display all lessons initially
                displayLessons(allLessons);
                updateResultsCount(allLessons.length);
                
            } catch (error) {
                console.error('Error loading lessons:', error);
                document.getElementById('resultsCount').textContent = 'Error loading lessons';
            }
        }

        // Populate filter dropdown options
        function populateFilterOptions() {
            const courses = [...new Set(allLessons.map(l => l.primary_course))].sort();
            const formats = [...new Set(allLessons.map(l => l.format))].sort();
            const instructors = [...new Set(allLessons.map(l => l.instructor))].sort();
            
            populateSelect('primaryCourse', courses);
            populateSelect('format', formats);
            populateSelect('instructor', instructors);
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        // Display lessons
        function displayLessons(lessons) {
            const grid = document.getElementById('lessonsGrid');
            grid.innerHTML = '';
            
            lessons.forEach(lesson => {
                const card = createLessonCard(lesson);
                grid.appendChild(card);
            });
        }

        // Create lesson card
        function createLessonCard(lesson) {
            const card = document.createElement('a');
            card.className = 'lesson-card';
            card.href = `lessons/${lesson.id}/`;
            
            card.innerHTML = `
                <div class="lesson-title">${lesson.title}</div>
                <div class="lesson-description">${lesson.description}</div>
                <div class="lesson-meta">
                    <div class="meta-item">
                        <span class="meta-label">Programming Skill:</span>
                        <span class="meta-value">${lesson.programming_skill}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Primary Course:</span>
                        <span class="meta-value">${lesson.primary_course}</span>
                    </div>
                    ${lesson.also_for && lesson.also_for.length > 0 ? `
                    <div class="meta-item">
                        <span class="meta-label">Also for:</span>
                        <span class="meta-value">${lesson.also_for.join(', ')}</span>
                    </div>
                    ` : ''}
                    <div class="meta-item">
                        <span class="meta-label">Format:</span>
                        <span class="meta-value">${lesson.format}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Instructor:</span>
                        <span class="meta-value">${lesson.instructor}</span>
                    </div>
                </div>
                <div class="lesson-tags">
                    ${lesson.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
            `;
            
            return card;
        }

        // Filter lessons
        function filterLessons() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const skillLevel = document.getElementById('skillLevel').value;
            const primaryCourse = document.getElementById('primaryCourse').value;
            const format = document.getElementById('format').value;
            const instructor = document.getElementById('instructor').value;

            let filteredLessons = allLessons;

            // Apply text search
            if (searchTerm) {
                const searchResults = fuse.search(searchTerm);
                filteredLessons = searchResults.map(result => result.item);
            }

            // Apply filters
            if (skillLevel) {
                filteredLessons = filteredLessons.filter(lesson => lesson.programming_skill === skillLevel);
            }
            if (primaryCourse) {
                filteredLessons = filteredLessons.filter(lesson => lesson.primary_course === primaryCourse);
            }
            if (format) {
                filteredLessons = filteredLessons.filter(lesson => lesson.format === format);
            }
            if (instructor) {
                filteredLessons = filteredLessons.filter(lesson => lesson.instructor === instructor);
            }

            displayLessons(filteredLessons);
            updateResultsCount(filteredLessons.length);
            updateActiveFilters();
        }

        function updateResultsCount(count) {
            document.getElementById('resultsCount').textContent = `${count} lesson${count !== 1 ? 's' : ''} found`;
        }

        function updateActiveFilters() {
            const activeFilters = [];
            const skillLevel = document.getElementById('skillLevel').value;
            const primaryCourse = document.getElementById('primaryCourse').value;
            const format = document.getElementById('format').value;
            const instructor = document.getElementById('instructor').value;

            if (skillLevel) activeFilters.push({ type: 'Programming Skill', value: skillLevel, id: 'skillLevel' });
            if (primaryCourse) activeFilters.push({ type: 'Course', value: primaryCourse, id: 'primaryCourse' });
            if (format) activeFilters.push({ type: 'Format', value: format, id: 'format' });
            if (instructor) activeFilters.push({ type: 'Instructor', value: instructor, id: 'instructor' });

            const container = document.getElementById('activeFilters');
            container.innerHTML = activeFilters.map(filter => 
                `<div class="filter-tag">${filter.type}: ${filter.value} <span class="remove" onclick="clearFilter('${filter.id}')">&times;</span></div>`
            ).join('');
        }

        function clearFilter(filterId) {
            document.getElementById(filterId).value = '';
            filterLessons();
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', filterLessons);
        document.getElementById('skillLevel').addEventListener('change', filterLessons);
        document.getElementById('primaryCourse').addEventListener('change', filterLessons);
        document.getElementById('format').addEventListener('change', filterLessons);
        document.getElementById('instructor').addEventListener('change', filterLessons);

        // Initialize
        loadTheme();
        loadLessons();
    </script>
</body>
</html>