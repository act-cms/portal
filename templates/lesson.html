<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - Lesson Portal</title>
    <style>
        /* Import fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            /* Brand colors */
            --primary-color: #ed1c24;
            --primary-light: rgba(237, 28, 36, 0.1);
            
            /* Light theme */
            --light-background: #fafafa;
            --light-surface: #f5f5f5;
            --light-card: #ffffff;
            --light-text-primary: #333333;
            --light-text-secondary: #666666;
            --light-border: #e0e0e0;
            --light-shadow: rgba(0, 0, 0, 0.08);
            
            /* Dark theme */
            --dark-background: #1a1a1a;
            --dark-surface: #2a2a2a;
            --dark-card: #2f2f2f;
            --dark-text-primary: #f0f0f0;
            --dark-text-secondary: #b0b0b0;
            --dark-border: #404040;
            --dark-shadow: rgba(0, 0, 0, 0.3);
        }

        /* Default to light theme */
        body {
            --background: var(--light-background);
            --surface: var(--light-surface);
            --card: var(--light-card);
            --text-primary: var(--light-text-primary);
            --text-secondary: var(--light-text-secondary);
            --border: var(--light-border);
            --shadow: var(--light-shadow);
        }

        /* Dark theme */
        body.dark-theme {
            --background: var(--dark-background);
            --surface: var(--dark-surface);
            --card: var(--dark-card);
            --text-primary: var(--dark-text-primary);
            --text-secondary: var(--dark-text-secondary);
            --border: var(--dark-border);
            --shadow: var(--dark-shadow);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 0;
            border-bottom: 1px solid var(--primary-color);
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .back-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .theme-toggle {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            border-color: var(--primary-color);
        }

        .theme-icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Lesson Header */
        .lesson-header {
            background: var(--card);
            padding: 32px;
            border-radius: 12px;
            margin-bottom: 32px;
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .lesson-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .lesson-summary {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .lesson-meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .meta-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .meta-value {
            color: var(--text-primary);
            text-align: right;
        }

        .lesson-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background: var(--surface);
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            border: 1px solid var(--border);
            font-weight: 500;
        }

        /* Content Sections */
        .content-section {
            background: var(--card);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .content-section h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
        }

        .content-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .content-section p {
            margin-bottom: 16px;
            line-height: 1.7;
        }

        .content-section ul {
            margin-left: 20px;
            margin-bottom: 16px;
        }

        .content-section li {
            margin-bottom: 8px;
        }

        /* Prerequisites */
        .prereq-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .prereq-box {
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .prereq-box.scientific {
            background: rgba(34, 139, 34, 0.1);
            border-left-color: #228b22;
        }

        .prereq-box.programming {
            background: rgba(30, 144, 255, 0.1);
            border-left-color: #1e90ff;
        }

        .prereq-box h4 {
            font-weight: 600;
            margin-bottom: 12px;
        }

        .prereq-box.scientific h4 {
            color: #228b22;
        }

        .prereq-box.programming h4 {
            color: #1e90ff;
        }

        .prereq-box ul {
            margin-left: 16px;
        }

        .prereq-box li {
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        /* Learning Objectives */
        .objectives-list {
            background: var(--surface);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        /* Notebook Sequence */
        .notebook-sequence {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .notebook-item {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .notebook-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .notebook-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .notebook-number {
            background: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .notebook-header h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .notebook-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
        }

        .duration {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
        }

        /* Materials Section */
        .materials-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .material-item {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .material-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .material-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .material-type-icon {
            width: 18px;
            height: 18px;
            fill: var(--primary-color);
            flex-shrink: 0;
        }

        .material-title {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .material-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
        }

        .material-objectives {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .material-objectives.collapsed {
            display: none;
        }

        .objectives-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 12px;
            padding: 4px 0;
            text-decoration: underline;
        }

        .objectives-toggle:hover {
            opacity: 0.8;
        }

        .material-objectives h5 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .material-objectives ul {
            margin-left: 16px;
        }

        .material-objectives li {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .btn {
            display: inline-block;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #d91920;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .access-note {
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .access-note a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .access-note a:hover {
            text-decoration: underline;
        }

        /* Platform Options */
        .platform-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .platform-card {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .platform-card.recommended {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }

        .platform-card h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .platform-card.recommended h4 {
            color: var(--primary-color);
        }

        .platform-card p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .platform-card ul {
            margin-left: 16px;
        }

        .platform-card li {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 32px 0;
            color: var(--text-secondary);
            border-top: 1px solid var(--primary-color);
            margin-top: 48px;
            font-size: 14px;
        }

        /* Links */
        a {
            color: var(--primary-color);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .lesson-title {
                font-size: 28px;
            }
            
            .lesson-meta-grid {
                grid-template-columns: 1fr;
            }
            
            .materials-grid {
                grid-template-columns: 1fr;
            }
            
            .platform-options {
                grid-template-columns: 1fr;
            }
            
            .prereq-grid {
                grid-template-columns: 1fr;
            }
            
            .notebook-actions {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="../../index.html" class="back-link">← Back to Lesson Portal</a>
            <h1>Lesson Portal</h1>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
                <svg class="theme-icon" id="themeIcon" viewBox="0 0 24 24">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <span id="themeText">Dark Mode</span>
            </button>
        </div>

        <div class="lesson-header">
            <h1 class="lesson-title">{{ title }}</h1>
            <p class="lesson-summary">{{ description }}</p>
            
            <div class="lesson-meta-grid">
                <div class="meta-item">
                    <span class="meta-label">Programming Skill:</span>
                    <span class="meta-value">{{ programming_skill }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Primary Course:</span>
                    <span class="meta-value">{{ primary_course }}</span>
                </div>
                {% if also_for %}
                <div class="meta-item">
                    <span class="meta-label">Also for:</span>
                    <span class="meta-value">{{ also_for | join(', ') }}</span>
                </div>
                {% endif %}
                <div class="meta-item">
                    <span class="meta-label">Format:</span>
                    <span class="meta-value">{{ format }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Instructor:</span>
                    <span class="meta-value">{{ instructor }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Estimated Time:</span>
                    <span class="meta-value">{{ estimated_time }}</span>
                </div>
            </div>

            <div class="lesson-tags">
                {% for tag in tags %}
                <span class="tag">{{ tag }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="content-section">
            <h2>Overview</h2>
            {% if expanded_description %}
                {% for paragraph in expanded_description.split('\n\n') %}
                    {% if paragraph.strip() %}
                    <p>{{ paragraph.strip() }}</p>
                    {% endif %}
                {% endfor %}
            {% else %}
            <p>{{ description }}</p>
            {% endif %}

            <div class="objectives-list">
                <h4>Scientific Learning Objectives</h4>
                <ul>
                    {% for objective in scientific_objectives %}
                    <li>{{ objective }}</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="objectives-list" style="margin-top: 16px;">
                <h4>Cyberinfrastructure Learning Objectives</h4>
                <ul>
                    {% for objective in cyberinfrastructure_objectives %}
                    <li>{{ objective }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2>Prerequisites</h2>
            <div class="prereq-grid">
                <div class="prereq-box scientific">
                    <h4>Scientific Prerequisites:</h4>
                    <ul>
                        {% for prereq in scientific_prerequisites %}
                        <li>{{ prereq }}</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="prereq-box programming">
                    <h4>Programming Prerequisites:</h4>
                    <ul>
                        {% for prereq in programming_prerequisites %}
                        <li>{{ prereq }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Course Materials</h2>
            
            {% if materials %}
            <div class="materials-list">
                {% for material in materials %}
                <div class="material-item">
                    <div class="material-header">
                        {% if material.type == "notebook" %}
                        <svg class="material-type-icon" viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        {% elif material.type == "slides" %}
                        <svg class="material-type-icon" viewBox="0 0 24 24">
                            <path d="M8.5 8.5L11 6L14 9l3-3.5V19H6V8.5zm11 11V5H4v14.5h15.5z"/>
                        </svg>
                        {% elif material.type == "document" %}
                        <svg class="material-type-icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        {% elif material.type == "video" %}
                        <svg class="material-type-icon" viewBox="0 0 24 24">
                            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                        </svg>
                        {% elif material.type == "dataset" %}
                        <svg class="material-type-icon" viewBox="0 0 24 24">
                            <path d="M12,3C7.58,3 4,4.79 4,7C4,9.21 7.58,11 12,11C16.42,11 20,9.21 20,7C20,4.79 16.42,3 12,3M4,9V12C4,14.21 7.58,16 12,16C16.42,16 20,14.21 20,12V9C20,11.21 16.42,13 12,13C7.58,13 4,11.21 4,9M4,14V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V14C20,16.21 16.42,18 12,18C7.58,18 4,16.21 4,14Z"/>
                        </svg>
                        {% else %}
                        <svg class="material-type-icon" viewBox="0 0 24 24">
                            <path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z"/>
                        </svg>
                        {% endif %}
                        <h4 class="material-title">{{ material.title }}</h4>
                    </div>
                    <p>{{ material.description }}</p>
                    <div class="material-actions">
                        {% if material.type == "notebook" %}
                        <a href="{{ material.url }}" class="btn btn-primary">Open Notebook</a>
                        {% elif material.type == "slides" %}
                        <a href="{{ material.url }}" class="btn btn-secondary">View Slides</a>
                        {% elif material.type == "video" %}
                        <a href="{{ material.url }}" class="btn btn-secondary">Watch Video</a>
                        {% else %}
                        <a href="{{ material.url }}" class="btn btn-secondary">Access Material</a>
                        {% endif %}
                        <span class="duration">{{ material.duration }}</span>
                    </div>
                    {% if material.objectives %}
                    <button class="objectives-toggle" onclick="toggleObjectives(this)">Show Learning Objectives</button>
                    <div class="material-objectives collapsed">
                        <h5>Learning Objectives:</h5>
                        <ul>
                            {% for objective in material.objectives %}
                            <li>{{ objective }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% elif notebooks %}
            <!-- Legacy notebook support -->
            <h3>Student Materials</h3>
            <div class="notebook-sequence">
                {% for notebook in notebooks %}
                <div class="notebook-item">
                    <div class="notebook-header">
                        <span class="notebook-number">{{ loop.index }}</span>
                        <h4>{{ notebook.title }}</h4>
                    </div>
                    <p>{{ notebook.description }}</p>
                    <div class="notebook-actions">
                        <a href="https://colab.research.google.com/github/{{ github_org }}/{{ github_repo }}/blob/main/{{ public_repo_path }}/{{ notebook.filename }}" class="btn btn-primary">Open in Colab</a>
                        <span class="duration">~{{ notebook.duration }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% elif notebook %}
            <!-- Single notebook support -->
            <h3>Student Materials</h3>
            <div class="notebook-sequence">
                <div class="notebook-item">
                    <div class="notebook-header">
                        <span class="notebook-number">1</span>
                        <h4>{{ title }}</h4>
                    </div>
                    <p>{{ description }}</p>
                    <div class="notebook-actions">
                        <a href="https://colab.research.google.com/github/{{ github_org }}/{{ github_repo }}/blob/main/{{ public_repo_path }}/{{ notebook.filename }}" class="btn btn-primary">Open in Colab</a>
                        <span class="duration">~{{ notebook.duration }}</span>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <h3 style="margin-top: 32px;">Instructor Materials</h3>
            <div class="materials-grid">
                <div class="material-card">
                    <h4>Complete Instructor Package</h4>
                    <p>Solutions for all notebooks, teaching notes, assessment rubrics, and additional examples.</p>
                    <a href="https://github.com/{{ github_org }}/{{ instructor_repo }}/tree/main/{{ instructor_repo_path }}" class="btn btn-secondary">
                        Instructor Resources
                    </a>
                    <p class="access-note">
                        Requires instructor verification. 
                        <a href="mailto:{{ instructor_email }}?subject=Instructor Access Request&body=Please include:%0A- Your name and institution%0A- Your GitHub username%0A- Courses you teach%0A%0APlease send from your academic email address.">Request access</a> 
                        if you don't have permission.
                    </p>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Platform Requirements</h2>
            
            <div class="platform-options">
                {% for platform in platforms %}
                {% set platform_key = platform.lower().replace(' ', '_') %}
                {% if platform == recommended_platform %}
                <div class="platform-card recommended">
                    {% include 'platforms/' + platform_key + '.html' %}
                </div>
                {% else %}
                <div class="platform-card">
                    {% include 'platforms/' + platform_key + '.html' %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>

        <footer class="footer">
            <p>Lesson Portal - Updated automatically via GitHub Actions</p>
        </footer>
    </div>

    <script>
        // Theme management
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            body.classList.toggle('dark-theme');
            
            if (body.classList.contains('dark-theme')) {
                // Sun icon for light mode toggle
                themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
                themeText.textContent = 'Light Mode';
                localStorage.setItem('theme', 'dark');
            } else {
                // Moon icon for dark mode toggle
                themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
                themeText.textContent = 'Dark Mode';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeIcon').innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
                document.getElementById('themeText').textContent = 'Light Mode';
            }
        }

        // Toggle objectives function
        function toggleObjectives(button) {
            const objectives = button.nextElementSibling;
            const isCollapsed = objectives.classList.contains('collapsed');
            
            if (isCollapsed) {
                objectives.classList.remove('collapsed');
                button.textContent = 'Hide Learning Objectives';
            } else {
                objectives.classList.add('collapsed');
                button.textContent = 'Show Learning Objectives';
            }
        }

        // Initialize
        loadTheme();
    </script>
</body>
</html>